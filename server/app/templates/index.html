<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta property="og:title" content="UF Scheduler" />
  <meta property="og:description" content="UF Scheduler" />
  <meta property="og:url" content="{{ url }}" />

  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
    rel="stylesheet" />

  <link rel="stylesheet" href="{{ url_for('static', filename='styles/main.css') }}" />
  <link rel="icon" href="{{ url_for('static', filename='img/favicon.ico') }}" type="image/x-icon" />
  <title>{{ title }}</title>
</head>

<body>
  {% include 'nav_header.html' %}

  <h1>{{ title }}</h1>
  <form action="{{ url_for('main.unlocks_redirect') }}" method="post">
    <label for="tentative-code">Tentative course:</label><br />
    <input id="tentative-code" name="tentative-code" required><br /><br />
    <!-- Cap at arbitrary number of courses -->
    <label for="code1">Courses completed:</label><br />
    <div id="course-inputs" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px;">
      {% for i in range(1, 6) %}
        <input id="code{{ i }}" name="code{{ i }}" {% if i == 1 %}required{% endif %} placeholder="Course code {{ i }}" />
      {% endfor %}
    </div>
    <button type="button" id="add-courses-btn">[+]</button>
    <button type="button" id="rm-courses-btn">[-]</button>
    <script>
      const maxCourses = {{ max_courses_taken }};  // ignore the red squiggles, this works fine
      const minCourses = 5;
      const step = 5;
      const courseInputsDiv = document.getElementById('course-inputs');
      const addBtn = document.getElementById('add-courses-btn');
      const rmBtn = document.getElementById('rm-courses-btn');

      addBtn.addEventListener('click', function() {
        const currentCount = courseInputsDiv.querySelectorAll('input').length;
        if (currentCount >= maxCourses) return;
        const nextCount = Math.min(currentCount + step, maxCourses);
        for (let i = currentCount + 1; i <= nextCount; i++) {
          const input = document.createElement('input');
          input.id = 'code' + i;
          input.name = 'code' + i;
          input.placeholder = 'Course code ' + i;
          courseInputsDiv.appendChild(input);
        }
        if (nextCount === maxCourses) addBtn.disabled = true;
        if (nextCount > minCourses) rmBtn.disabled = false;
      });

      rmBtn.addEventListener('click', function() {
        const currentCount = courseInputsDiv.querySelectorAll('input').length;
        if (currentCount <= minCourses) return;
        const removeCount = Math.min(step, currentCount - minCourses);
        for (let i = 0; i < removeCount; i++) {
          courseInputsDiv.removeChild(courseInputsDiv.lastElementChild);
        }
        if (courseInputsDiv.querySelectorAll('input').length === minCourses) rmBtn.disabled = true;
        if (courseInputsDiv.querySelectorAll('input').length < maxCourses) addBtn.disabled = false;
      });

      // Initial state
      if (courseInputsDiv.querySelectorAll('input').length === minCourses) rmBtn.disabled = true;
    </script>
    <br /><br />
    <label for="semester">Semester:</label><br />
    <select id="semester" name="semester">
        {% for sem in semesters %}
            <option
                    value="{{ sem }}"
                    {% if sem == default_semester %}selected{% endif %}>
                {{ sem|upper }}
            </option>
        {% endfor %}
    </select><br /><br />
    <label for="view_type">Data Structure:</label><br />
    <select id="view_type" name="view_type">
      <option value="tcm">Transative Closure Map</option>
      <option value="graph">Graph</option>
    </select><br /><br />
    <button type="submit">Show what it unlocks (what it is a prerequesite for)</button>
  </form>
</body>
</html>
